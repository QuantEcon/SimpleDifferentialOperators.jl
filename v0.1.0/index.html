<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>﻿Installation · SimpleDifferentialOperators.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>SimpleDifferentialOperators.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>﻿Installation</a><ul class="internal"><li class="toplevel"><a class="toctext" href="#Usage-1">Usage</a></li><li><a class="toctext" href="#Regular-grids-1">Regular grids</a></li><li><a class="toctext" href="#Irregular-grids-1">Irregular grids</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>﻿Installation</a></li></ul><a class="edit-page" href="https://github.com/QuantEcon/SimpleDifferentialOperators.jl/blob/master/docs/src/index.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>﻿Installation</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Installation-1" href="#Installation-1">﻿Installation</a></h1><p>To install, run</p><pre><code class="language-julia">] dev https://github.com/QuantEcon/SimpleDifferentialOperators.jl</code></pre><h1><a class="nav-anchor" id="Usage-1" href="#Usage-1">Usage</a></h1><p><code>robin_diffusionoperators(x, ξ)</code> takes a vector or range of grids <code>x</code> and a coefficient <code>ξ</code> to be used for boundary conditions</p><div>\[
\begin{aligned}
    \xi v(0) + \nabla_z v(0 ) &amp;= 0 \\
    \xi v(\bar{z}) + \nabla_z v(\bar{z}) &amp;= 0
\end{aligned}
$$
 
and returns a tuple of discretized differential operators in matrix `(L_1_minus, L_1_plus, L_2)` that represent the corresponding forward-difference first-order derivative operator, backward-difference first-order derivative operator, and the centralized second-order derivative operator, respectively. 

For instance, to compute the first-order derivative of scalar-valued function $f$ on given grids $x$ with the boundary condition coefficient $ξ$, one can run the following lines:

```julia
L_1_plus = robin_diffusionoperator(x, ξ) # compute discretized differential operator
f_prime_fd = L_1_plus * f.(x) # first order derivative using forward difference
```

When `ξ` is zero, `reflecting_diffusionoperators(x)` can be used instead.


Derivation
=====
More details on derivation can be found [here](https://github.com/ubcecon/computing_and_datascience/blob/master/continuous_time_methods/notes/differential-operator-on-irregular-grids.tex).

Setup
-------------

-   Define an irregular grid $\{z_i\}_{i=1}^P$ with $z_1 = 0$ and
    $z_P = \bar{z}$ is a &quot;large&quot; number. Denote the grid with the
    variable name, i.e. $z \equiv \{z_i\}_{i=1}^P$.

-   Denote the distance between the grid points as the *backward*
    difference:

    $$
    \begin{aligned}
        \Delta_{i,-} &amp;\equiv z_i - z_{i-1},\, \text{for } i = 2,\ldots, P\\
        \Delta_{i,+} &amp;\equiv z_{i+1} - z_i,\, \text{for } i = 1,\ldots, P-1
    \end{aligned}
    $$

-   Assume $\Delta_{1, -} = \Delta_{1, +}$ and
    $\Delta_{P, +} = \Delta_{P, -}$, due to ghost points, $z_0$ and
    $z_{P+1}$ on both boundaries. (i.e., the distance to the ghost nodes
    are the same as the distance to the closest nodes). Then define the
    vector of backward and forward first differences as 

    $$
        \Delta_{-} \equiv \begin{bmatrix} z_2 - z_1 \\
        \text{diff}(z)
        \end{bmatrix}
    $$

    $$
        \Delta_{+} \equiv \begin{bmatrix} \text{diff}(z)\\
        z_P - z_{P-1}
        \end{bmatrix}
    $$
    

-   Reflecting barrier conditions: 

    $$
    \begin{aligned}
        \xi v(0) + \nabla_z v(0 ) &amp;= 0 &amp; (1) \\
        \xi v(\bar{z}) + \nabla_z v(\bar{z}) &amp;= 0 &amp; (2)
    \end{aligned}
    $$
    
Let $L_1^{-}$ be the discretized backward first differences and $L_2$
be the discretized central differences subject to the Neumann boundary
conditions such that $L_1^{-} v(t)$ and $L_2 v(t)$ represent the first
and second derivatives of $v(z)$ respectively at $t$. For second
derivatives, we use the following numerical scheme from [Achdou et al.
(2017)](http://www.princeton.edu/~moll/HACT.pdf):

$$v&#39;&#39;(z_i) \approx \dfrac{ \Delta_{i,-} v( z_i + \Delta_{i,+}) - (\Delta_{i,+} + \Delta_{i,-}) v( z_i ) + \Delta_{i,+} v( z_i - \Delta_{i,-})}{\frac{1}{2}(\Delta_{i,+} + \Delta_{i,-}) \Delta_{i,+} \Delta_{i,-} }, \text{for } i = 1, \ldots, P\]</div><h2><a class="nav-anchor" id="Regular-grids-1" href="#Regular-grids-1">Regular grids</a></h2><p>Suppose that the grids are regular, i.e., elements of <span>$\text{diff}(z)$</span> are all identical with <span>$\Delta$</span> for some <span>$\Delta &gt; 0$</span>.</p><p>Using the backward first-order difference, the first boundary condition <span>$(1)$</span> can be alternatively represented as </p>$<p>\begin{aligned} \dfrac{v(0) - v(-\Delta)}{\Delta} &amp;= - \xi v(0) \end{aligned} $</p><p>Similarly, using discretized central differences of second orders, the first boundary condition <span>$(1)$</span> yields</p>$<p>\begin{aligned} \dfrac{v (\Delta) - 2 v(0) + v(-\Delta)}{\Delta^2} &amp;=   \dfrac{v(\Delta) - v(0)}{\Delta^2} - \dfrac{1}{\Delta}\dfrac{v (0) - v(-\Delta) }{\Delta}  \
&amp;= \dfrac{v(\Delta) - v(0)}{\Delta^2} + \dfrac{1}{\Delta} \xi v(0)  \  &amp;= \dfrac{1}{\Delta^2}  (- 1 + \Delta \xi) v(0)  + \dfrac{1}{\Delta^2}  v(\Delta)   \end{aligned} $</p><p>Similarly, for the secondary boundary condition <span>$(2)$</span>, we have </p>$<p>\begin{aligned} \dfrac{v (\bar{z} + \Delta) - 2 v(\bar{z} ) + v(\bar{z} -\Delta)}{\Delta^2} &amp;=   \dfrac{v(\bar{z} - \Delta) - v(\bar{z})}{\Delta^2} + \dfrac{1}{\Delta}\dfrac{ v(\bar{z}+\Delta) - v (\bar{z}) }{\Delta}  \
&amp;= \dfrac{v(\bar{z} - \Delta) - v(\bar{z})}{\Delta^2}  - \dfrac{1}{\Delta} \xi v(\bar{z})  \  &amp;= \dfrac{1}{\Delta^2}  (- 1 - \Delta \xi) v(\bar{z})  + \dfrac{1}{\Delta^2}  v(\bar{z} - \Delta)   \end{aligned} $</p><p>Thus, the corresponding <span>$L_1^{-}$</span> and <span>$L_2$</span> matrices are defined as</p>$<p>\begin{aligned} L<em>1^{-} &amp;\equiv \frac{1}{\Delta}\begin{pmatrix} 1 - (1 + \xi \Delta) &amp;0&amp;0&amp;\dots&amp;0&amp;0&amp;0\
-1&amp;1&amp;0&amp;\dots&amp;0&amp;0&amp;0\
\vdots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\vdots&amp;\vdots\
0&amp;0&amp;0&amp;\dots&amp;-1&amp;1&amp;0\
0&amp;0&amp;0&amp;\cdots&amp;0&amp;-1&amp;1 \end{pmatrix}</em>{P\times P}\
L<em>2 &amp;\equiv \frac{1}{\Delta^2}\begin{pmatrix} -2 + (1 + \xi\Delta) &amp;1&amp;0&amp;\dots&amp;0&amp;0&amp;0\
1&amp;-2&amp;1&amp;\dots&amp;0&amp;0&amp;0\
\vdots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\vdots&amp;\vdots\
0&amp;0&amp;0&amp;\dots&amp;1&amp;-2&amp;1\
0&amp;0&amp;0&amp;\cdots&amp;0&amp;1&amp;-2 + (1- \xi\Delta) \end{pmatrix}</em>{P\times P} \end{aligned} $</p><h2><a class="nav-anchor" id="Irregular-grids-1" href="#Irregular-grids-1">Irregular grids</a></h2><p>Using the backward first-order difference, the first boundary condition <span>$(1)$</span> can be alternatively represented as </p>$<p>\begin{aligned} \dfrac{v(0) - v(-\Delta<em>{1, -})}{\Delta</em>{1, -}} &amp;= - \xi v(0) \end{aligned} $</p><p>Note that we have assumed that <span>$\Delta_{1,-} = \Delta_{1,+}$</span> and <span>$\Delta_{P,+} = \Delta_{P,-}$</span> for the ghost notes. Using discretized central differences of second orders, the first boundary condition <span>$(1)$</span> yields</p>$<p>\begin{aligned} &amp;\dfrac{\Delta<em>{1,-} v( \Delta</em>{1,+}) - (\Delta<em>{1,+} + \Delta</em>{1,-}) v( 0 ) + \Delta<em>{1,+}  v( - \Delta</em>{1,-})}{\frac{1}{2}(\Delta<em>{1,+} + \Delta</em>{1,-}) \Delta<em>{1,+} \Delta</em>{1,-} } \
&amp;= \dfrac{v (\Delta<em>{1, +}) - 2 v(0) + v(-\Delta</em>{1, +})}{\Delta<em>{1, +}^2} \ &amp;= \dfrac{v(\Delta</em>{1, +}) - v(0)}{\Delta<em>{1, +}^2} - \dfrac{1}{\Delta</em>{1, +}}\dfrac{v (0) - v(-\Delta<em>{1, +}) }{\Delta</em>{1, +}}  \
&amp;= \dfrac{v(\Delta<em>{1, +}) - v(0)}{\Delta</em>{1, +}^2} + \dfrac{1}{\Delta<em>{i,+}} \xi v(0)  \  &amp;= \dfrac{1}{\Delta</em>{1, +}^2}  (- 1 + \Delta<em>{1, +} \xi) v(0)  + \dfrac{1}{\Delta</em>{1, +}^2}  v(\Delta_{1, +})   \end{aligned} $</p><p>Similarly, for the secondary boundary condition <span>$(2)$</span>, we have </p>$<p>\begin{aligned} &amp;\dfrac{\Delta<em>{P,-} v( \bar{z} + \Delta</em>{P,+}) - (\Delta<em>{P,+} + \Delta</em>{P,-}) v(\bar{z} ) + \Delta<em>{P,+}  v( \bar{z} - \Delta</em>{P,-})}{\frac{1}{2}(\Delta<em>{P,+} + \Delta</em>{P,-}) \Delta<em>{P,+} \Delta</em>{P,-} } \
&amp;=\dfrac{v (\bar{z} + \Delta<em>{P,-}) - 2 v(\bar{z} ) + v(\bar{z} -\Delta</em>{P,-})}{\Delta<em>{P,-}^2} \
&amp;=   \dfrac{v(\bar{z} - \Delta</em>{P,-}) - v(\bar{z})}{\Delta<em>{P,-}^2} + \dfrac{1}{\Delta</em>{P,-}}\dfrac{ v(\bar{z}+\Delta<em>{P,-}) - v (\bar{z}) }{\Delta</em>{P,-}}  \
&amp;= \dfrac{v(\bar{z} - \Delta<em>{P,-}) - v(\bar{z})}{\Delta</em>{P,-}^2}  - \dfrac{1}{\Delta<em>{P,-}} \xi v(\bar{z})  \  &amp;= \dfrac{1}{\Delta</em>{P,-}^2}  (- 1 - \Delta<em>{P,-} \xi) v(\bar{z})  + \dfrac{1}{\Delta</em>{P,-}^2}  v(\bar{z} - \Delta_{P,-})   \end{aligned} $</p><p>Thushe corresponding <span>$L_1^{-}$</span> and <span>$L_2$</span> matrices are defined as</p>$<p>\begin{aligned} L<em>1^{-} &amp;\equiv \begin{pmatrix} \Delta^{-1}</em>{1,-} [1 - (1 + \xi \Delta^{-1}<em>{1,-})] &amp;0&amp;0&amp;\dots&amp;0&amp;0&amp;0\
-\Delta</em>{2,-}^{-1}&amp;\Delta<em>{2,-}^{-1}&amp;0&amp;\dots&amp;0&amp;0&amp;0\
\vdots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\vdots&amp;\vdots\
0&amp;0&amp;0&amp;\dots&amp;-\Delta</em>{P-1,-}^{-1}&amp;\Delta<em>{P-1,-}^{-1}&amp;0\
0&amp;0&amp;0&amp;\cdots&amp;0&amp;-\Delta</em>{P,-}^{-1}&amp;\Delta<em>{P,-}^{-1} \end{pmatrix}</em>{P\times P} \
L<em>2 &amp;\equiv \begin{pmatrix} \Delta</em>{1,+}^{-2}[-2 + (1+\xi \Delta<em>{1,+})] &amp;\Delta</em>{1,+}^{-2}&amp;0&amp;\cdots&amp;0&amp;0&amp;0 \
\vdots&amp;\ddots&amp;\ddots&amp;\ddots&amp;\ddots&amp;\vdots&amp;\vdots\
0&amp;\cdots&amp;2(\Delta<em>{i,+}+\Delta</em>{i,-})^{-1} \Delta<em>{i,-}^{-1} &amp;-2\Delta</em>{i,-}^{-1} \Delta<em>{i,+}^{-1}  &amp; 2 (\Delta</em>{i,+}+\Delta<em>{i,-})^{-1} \Delta</em>{i,+}^{-1}&amp;\cdots&amp;0 \
\vdots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\ddots&amp;\ddots&amp;\vdots\
0&amp;0&amp;0&amp;\cdots&amp;0&amp;\Delta<em>{P,-}^{-2}&amp;\Delta</em>{P,-}^{-2} [-2 + (1- \xi\Delta<em>{P,-})] \end{pmatrix}</em>{P\times P} \end{aligned} $</p><footer><hr/></footer></article></body></html>
